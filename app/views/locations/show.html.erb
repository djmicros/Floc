<% provide(:title, @location.name) %>
<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

	<script type="text/javascript">
			  jQuery(document).ready(function($) {
		 
		        $('#myCarousel').carousel({
		                interval: 5000
		        });
		 
		        //Handles the carousel thumbnails
		        $('[id^=carousel-selector-]').click(function () {
		        var id_selector = $(this).attr("id");
		        try {
		            var id = /-(\d+)$/.exec(id_selector)[1];
		            console.log(id_selector, id);
		            jQuery('#myCarousel').carousel(parseInt(id));
		        } catch (e) {
		            console.log('Regex failed!', e);
		        }
		    });
		        // When the carousel slides, auto update the text
		        $('#myCarousel').on('slid.bs.carousel', function (e) {
		                 var id = $('.item.active').data('slide-number');
		                $('#carousel-text').html($('#slide-content-'+id).html());
		        });
		});
	  </script>

<div class="container">
	<div class="row">

            <div class="col-sm-6" id="slider-thumbs">
                <!-- Bottom switcher of slider -->
                <ul class="hide-bullets">
					<% @location.photos.each_with_index do |pic, index| %>
						<li class="col-sm-3">
							<%= link_to "#", class: "thumbnail", id: 'carousel-selector-' + index.to_s do %>
			            		<%= image_tag pic.photo.url, :width => '200px', :height => '200px' %>
							<% end %>
						</li>
					<% end %>
				</ul>
			</div>
			<div class="col-sm-6">
                <div class="col-xs-12" id="slider">
                    <!-- Top part of the slider -->
                    <div class="row">
                        <div class="col-sm-12" id="carousel-bounding-box">
                            <div class="carousel slide" id="myCarousel">
                                <div class="carousel-inner">            
                                <!-- Carousel items -->
									<% @location.photos.each_with_index do |pic, index| %>
	                                    <div class="item <%= "active" if index==0 %>" data-slide-number=<%= index.to_s %> >
	                                        <%= image_tag pic.photo.url, :width => '200px' %>
	                                    </div>
									<% end %>
                                </div>
									<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
	                                    <span class="glyphicon glyphicon-chevron-left"></span>
	                                </a>
	                                <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
	                                    <span class="glyphicon glyphicon-chevron-right"></span>
	                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
            	<h3>Info:</h3>
				</br>
					Tags:
					<%= raw @location.tag_list.map { |t| link_to t, tag_path(t)}.join(', ')%>
				</br>
					User:
					<%= @location.photos.first.photo.url %>
					<%= @location.user.name %>
					<%= @location.latitude %>
					<%= @location.longitude %>
				</br>

				<h4>Nearby:</h4>

				</br>
			</div>
			<div class="col-sm-12">
				<h4>Map:</h4>
				<div>
				  <div id="location_map" style='width: 100%; height: 300px;'></div>
				</div> 
			</div>
	</div>
</div>


	<script> 

		handler = Gmaps.build('Google');
		handler.buildMap({ internal: {id: 'location_map'}}, function(){
		  markers = handler.addMarkers(<%=raw @hash.to_json %>);
		handler.bounds.extendWith(markers);
		handler.fitMapToBounds();
		});

		    
	</script>



